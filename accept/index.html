<!doctype html>
<html lang="sv">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Offert accepterad</title>
<style>
  body {font-family: system-ui, sans-serif; margin:0; background:#fff}
  .wrap {max-width:720px; margin:40px auto; padding:24px}
  .card {border:1px solid #eee; border-radius:12px; padding:16px}
  .muted {color:#666}
</style>
<div class="wrap">
  <div class="card" id="view">Bearbetar…</div>
  <p class="muted">Du kan stänga denna sida när du ser bekräftelsen.</p>
</div>

<script>
(function(){
  const token = location.pathname.split("/").filter(Boolean)[1] || "";
  const v = document.getElementById("view");

  if (!token) {
    v.textContent = "Saknar token i URL:en.";
    return;
  }

  v.textContent = "Bearbetar…";

  fetch("/api/publicAccept", {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify({ token })
  })
    .then(r => r.json())
    .then(r => {
      if (!r.ok) throw new Error(r.error || "Något gick fel");
      v.innerHTML = "<h1>Tack!</h1><p>Offerten är nu <b>accepterad</b>.</p>";
    })
    .catch(() => {
      v.innerHTML = "<h1>Tack!</h1><p>Vi kunde inte bekräfta mot servern just nu, men din accept registreras visuellt.</p>";
    });
})();
</script>
